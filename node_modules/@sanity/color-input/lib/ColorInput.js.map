{"version":3,"file":"ColorInput.js","names":["set","patches","unset","setIfMissing","DEFAULT_COLOR","hex","hsl","h","s","l","a","hsv","v","rgb","r","g","b","source","ColorInput","PureComponent","React","createRef","nextColor","props","onChange","type","fieldPatches","fields","filter","field","name","map","nextFieldValue","isObject","jsonType","Object","assign","_type","PatchEvent","from","debounce","emitSetColor","focus","focusRef","current","render","readOnly","value","level","markers","presence","title","description","handleColorChange","options","disableAlpha","handleUnset","AddIcon","Boolean","handleCreateColor","PropTypes","shape","string","arrayOf","isRequired","func","bool","alpha","number","array"],"sources":["../src/ColorInput.js"],"sourcesContent":["///<reference types=\"@sanity/types/parts\" />\n\n/* eslint-disable id-length */\nimport React, {PureComponent} from 'react'\nimport PropTypes from 'prop-types'\nimport {PatchEvent, patches} from 'part:@sanity/form-builder'\nimport {debounce} from 'lodash'\nimport {Button} from '@sanity/ui'\nimport {AddIcon} from '@sanity/icons'\nimport {FormField} from '@sanity/base/components'\nimport ColorPicker from './ColorPicker'\n\nconst {set, unset, setIfMissing} = patches\n\nconst DEFAULT_COLOR = {\n  hex: '#24a3e3',\n  hsl: {h: 200, s: 0.7732, l: 0.5156, a: 1},\n  hsv: {h: 200, s: 0.8414, v: 0.8901, a: 1},\n  rgb: {r: 46, g: 163, b: 227, a: 1},\n  source: 'hex',\n}\n\nexport default class ColorInput extends PureComponent {\n  focusRef = React.createRef()\n  static propTypes = {\n    type: PropTypes.shape({\n      name: PropTypes.string,\n      title: PropTypes.string,\n      description: PropTypes.string,\n      fields: PropTypes.arrayOf(\n        PropTypes.shape({\n          name: PropTypes.string.isRequired,\n        })\n      ),\n    }).isRequired,\n    onChange: PropTypes.func.isRequired,\n    readOnly: PropTypes.bool,\n    value: PropTypes.shape({\n      hex: PropTypes.string,\n      alpha: PropTypes.number,\n    }),\n    markers: PropTypes.array,\n    presence: PropTypes.array,\n  }\n\n  focus() {\n    // todo: make the ColorPicker component support .focus()\n    if (this.focusRef.current && this.focusRef.current.focus) {\n      this.focusRef.current.focus()\n    }\n  }\n\n  emitSetColor = (nextColor) => {\n    const {onChange, type} = this.props\n\n    const fieldPatches = type.fields\n      .filter((field) => field.name in nextColor)\n      .map((field) => {\n        const nextFieldValue = nextColor[field.name]\n        const isObject = field.type.jsonType === 'object'\n        return set(\n          isObject ? Object.assign({_type: field.type.name}, nextFieldValue) : nextFieldValue,\n          [field.name]\n        )\n      })\n\n    onChange(\n      PatchEvent.from([\n        setIfMissing({_type: type.name}),\n        set(type.name, ['_type']),\n        set(nextColor.rgb.a, ['alpha']),\n        ...fieldPatches,\n      ])\n    )\n  }\n\n  // The color picker emits onChange events continuously while the user is sliding the\n  // hue/saturation/alpha selectors. This debounces the event to avoid excessive patches\n  handleColorChange = debounce(this.emitSetColor, 100)\n\n  handleCreateColor = () => {\n    this.emitSetColor(DEFAULT_COLOR)\n  }\n\n  handleUnset = () => {\n    this.props.onChange(PatchEvent.from(unset()))\n  }\n\n  render() {\n    const {type, readOnly, value, level, markers, presence} = this.props\n    return (\n      <FormField\n        title={type.title}\n        description={type.description}\n        level={level}\n        __unstable_markers={markers}\n        __unstable_presence={presence}\n      >\n        {value ? (\n          <ColorPicker\n            ref={this.focusRef}\n            color={value.hsl || value.hex}\n            readOnly={readOnly || type.readOnly}\n            onChange={this.handleColorChange}\n            disableAlpha={type.options && type.options.disableAlpha}\n            onUnset={this.handleUnset}\n          />\n        ) : (\n          <Button\n            icon={AddIcon}\n            mode=\"ghost\"\n            text=\"Create color\"\n            ref={this.focusRef}\n            disabled={Boolean(readOnly)}\n            onClick={this.handleCreateColor}\n          />\n        )}\n      </FormField>\n    )\n  }\n}\n"],"mappings":"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"}